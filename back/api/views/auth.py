from flask import send_from_directory, url_for, redirect, session

from api.app import oauth


def root():
    """
    Renders HTML template that bootstraps vue application.

    The template and all static files are generated by the front container and
    are only present when in "production" mode. Otherwise, the front container
    is the development server and proxys API calls to back (this flask
    application).
    """
    return send_from_directory('../templates', 'index.html')


def login():
    redirect_uri = url_for('authorize', _external=True)
    return oauth.shanty.authorize_redirect(redirect_uri, in_fragment=True)


def logout():
    del session['user']


def authorize():
    token = oauth.shanty.authorize_access_token()
    session['user'] = oauth.shanty.get('/api/users/whoami/')
    return redirect('/')
